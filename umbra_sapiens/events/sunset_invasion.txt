###################################
#
# SUNSET INVASION
# - The Fantasy Menace
#
###################################

# Written by Henrik Fåhraeus and Henrik Eklund

namespace = SSI

# First Contact - Beads and Feathers
# (There is another version of this event: SoA.3081 - triggered by a Demon Child.)
province_event = {
	id = SSI.1
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1250
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		has_global_flag = xochimilca_explorers
		has_global_flag = tlahuica_explorers
		has_global_flag = acolhua_explorers
		has_global_flag = tepaneca_explorers
		has_global_flag = chalca_explorers
		has_global_flag = tlaxcalteca_explorers
		NOR = {
			year = 1350
			has_global_flag = aztec_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 3723 # Tenochtitlan
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = aztec_explorers
		set_province_flag = aztec_explorers
		owner = { character_event = { id = SSI.74 } }
		culture = nahuatl
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = 1035000 # Acatl
					random_traits = yes
					culture = nahuatl
					religion = aztec
				}
				new_character = {
					c_mexico = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_mexico = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.3 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.3
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = aztec_arrival
		culture = nahuatl
		religion = aztec
		c_mexico = {
			holder_scope = {
				narrative_event = { id = SSI.4 }
			}
		}
	}
	
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.4
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 22
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 31
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 24
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = nahuatl
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = nahuatl
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}

# Aztecs Sacrifice Prisoner
character_event = {
	id = SSI.60
	desc = {
		trigger = {
			NOR = {
				religion_group = mesoamerican_rel_group
				religion_group = andean_rel_group	
				has_religion_feature = religion_ritual_sacrifice
			}
		}
		text = EVTDESC_SSI_060
	}
	desc = {
		trigger = {
			OR = {
				religion_group = mesoamerican_rel_group
				religion_group = andean_rel_group	
				has_religion_feature = religion_ritual_sacrifice
			}
		}
		text = EVTDESC_SSI_060_B
	}
	
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SSI_060
		trigger = {
			NOR = {
				religion_group = mesoamerican_rel_group
				religion_group = andean_rel_group	
				has_religion_feature = religion_ritual_sacrifice
			}
		}
	}
	option = {
		name = EVTOPTB_SSI_060
		trigger = {
			OR = {
				religion_group = mesoamerican_rel_group
				religion_group = andean_rel_group	
				has_religion_feature = religion_ritual_sacrifice
			}
		}
	}
}

# Aztecs Sacrifice Occupied Province Character
character_event = {
	id = SSI.61
	hide_window = yes
	
	ai = yes
	min_age = 16
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		in_command = no
		NOR = { religion_group = mesoamerican_rel_group
					religion_group = andean_rel_group	 }
		new_character = {
			OR = {
				religion_group = mesoamerican_rel_group
				religion_group = andean_rel_group	
			}
		}
	}
	
	immediate = {
		liege = {
			character_event = { id = SSI.62 }
		}
		new_character = {
			if = {
				limit = {
					ai = no
					ROOT = {
						controls_religion = yes
						NOR = {
							religion_group = mesoamerican_rel_group
							religion_group = andean_rel_group	
						}
					}
				}
				set_character_flag = achievement_holy_smoke
			}
		}
		death = { death_reason = death_sacrificed }
	}
	
	option = {
		name = OK
	}
}

# Liege Informed of Sacrifice
character_event = {
	id = SSI.62
	desc = EVTDESC_SSI_060
	
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SSI_060
	}
}

# Aztecs Sacrifice Prisoner (Aztec perspective)
character_event = {
	id = SSI.72
	desc = EVTDESC_SSI_072
	
	picture = GFX_evt_bishop_aztec
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SSI_072
		if = { 
			limit = { 
				FROM = { 
					is_ruler = no 
				} 
			}
			piety = 5
		}
		if = { 
			limit = { 
				FROM = { 
					tier = BARON
				} 
			}
			piety = 15
		}
		if = { 
			limit = { 
				FROM = { 
					tier = COUNT
				} 
			}
			piety = 30
		}
		if = { 
			limit = { 
				FROM = { 
					tier = DUKE
				} 
			}
			piety = 75
		}
		if = { 
			limit = { 
				FROM = { 
					tier = KING
				} 
			}
			piety = 150
		}
		if = { 
			limit = { 
				FROM = { 
					tier = EMPEROR
				} 
			}
			piety = 250
		}
	}
}

# Notification event at beginning of invasion.
character_event = {
	id = SSI.74
	desc = EVTDESC_SSI_001
	
	picture = GFX_evt_aztec_explorers
	border = GFX_event_normal_frame_war

	has_dlc = "Sunset Invasion"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
#Xochimilca
province_event = {
	id = SSI.100
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = xochimilca_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 4816 # Xochimilco
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = xochimilca_explorers
		set_province_flag = xochimilca_explorers
		owner = { character_event = { id = SSI.74 } }
		4865 = {
		culture = xochimilca
		religion = aztec
		}
		culture = xochimilca
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = xochimilca
					religion = aztec
				}
				new_character = {
					c_xomchimilco = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_xomchimilco = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.101 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.101
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes

	immediate = {
		set_global_flag = aztec_arrival
		culture = xochimilca
		religion = aztec
		c_xomchimilco = {
			holder_scope = {
				narrative_event = { id = SSI.102 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.102
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = xochimilca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = xochimilca
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}
#Tlahuica/Cuauhnahuacnew
province_event = {
	id = SSI.103
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = tlahuica_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 4864 # Cuauhnahuacnew
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = tlahuica_explorers
		set_province_flag = tlahuica_explorers
		owner = { character_event = { id = SSI.74 } }
		4102 = {
		culture = tlahuica
		religion = aztec
		}
		culture = tlahuica
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = tlahuica
					religion = aztec
				}
				new_character = {
					c_cuauhnahuacnew = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_cuauhnahuacnew = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.104 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.104
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = aztec_arrival
		culture = tlahuica
		religion = aztec
		c_cuauhnahuacnew = {
			holder_scope = {
				narrative_event = { id = SSI.105 }
			}
		}
	}
	
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.105
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlahuica
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlahuica
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}
#Acolhua
province_event = {
	id = SSI.106
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = acolhua_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 4824 # Tetzcoco
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = acolhua_explorers
		set_province_flag = acolhua_explorers
		owner = { character_event = { id = SSI.74 } }
		4814 = {
		culture = acolhua
		religion = aztec
		}
		3728 = {
		culture = acolhua
		religion = aztec
		}
		culture = acolhua
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = acolhua
					religion = aztec
				}
				new_character = {
					c_tetzcoco = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_tetzcoco = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.107 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.107
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = aztec_arrival
		culture = acolhua
		religion = aztec
		c_tetzcoco = {
			holder_scope = {
				narrative_event = { id = SSI.108 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.108
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = acolhua
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = acolhua
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}
#Tepaneca
province_event = {
	id = SSI.110
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {	
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1050
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = tepaneca_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 3723 # Tenochtitlan/Apotzecualco
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = tepaneca_explorers
		set_province_flag = tepaneca_explorers
		owner = { character_event = { id = SSI.74 } }
		3718 = {
		culture = tepaneca
		religion = aztec
		}
		culture = tepaneca
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = tepaneca
					religion = aztec
				}
				new_character = {
					c_tenochtitlan = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_tenochtitlan = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.111 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.111
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = aztec_arrival
		culture = tepaneca
		religion = aztec
		c_tenochtitlan = {
			holder_scope = {
				narrative_event = { id = SSI.112 }
			}
		}
	}
	
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.112
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tepaneca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tepaneca
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}
#Chalca
province_event = {
	id = SSI.113
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = chalca_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 3725 # Chalco
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = chalca_explorers
		set_province_flag = chalca_explorers
		owner = { character_event = { id = SSI.74 } }
		culture = chalca
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = chalca
					religion = aztec
				}
				new_character = {
					c_cuauhnahuac = {
						grant_title = PREV
					}
					set_government_type = feudal_government
					c_cuauhnahuac = {
						add_law = succ_primogeniture
						add_law = agnatic_succession
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.114 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.114
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = aztec_arrival
		culture = chalca
		religion = aztec
		c_cuauhnahuac = {
			holder_scope = {
				narrative_event = { id = SSI.115 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.115
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = chalca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = chalca
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}
#tlaxcalteca 
province_event = {
	id = SSI.116
	hide_window = yes

	has_dlc = "Sunset Invasion"
	
	trigger = {
		OR = {
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = historical
				}
				year = 1200
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = random
				}
				total_years_played = 50
			}
			AND = {
				has_game_rule = {
					name = aztec_invasion
					value = delayed_random
				}
				year = 1000
				total_years_played = 50
			}
		}
		NOR = {
			year = 1350
			has_global_flag = tlaxcalteca_explorers 
			has_game_rule = {
				name = aztec_invasion
				value = off
			}
			has_global_flag = demon_child_to_aztecs
		}
			province_id = 4822 # Tlaxcalareal
	}
	
	immediate = {
		if = { 
			limit = {  
				OR = {
					has_game_rule = {
						name = aztec_invasion
						value = random
					}
					has_game_rule = {
						name = aztec_invasion
						value = delayed_random
					}
				}
				NOT = { year = 1300 } #Will never fire otherwise.
			}
			random = { 
				chance = 40
					modifier = {
						factor = 0.75
						total_years_played = 100
					}
					modifier = {
						factor = 0.5
						total_years_played = 150
					}
					modifier = {
						factor = 0.25
						total_years_played = 200
					}
				break = yes #Chance of misfire to prevent the randomized invasions from firing immediately after 50 years of game.
			}
		}
		log = "AZTEC INVASION IMMEDIATE 5532432005"
		set_global_flag = tlaxcalteca_explorers
		set_province_flag = tlaxcalteca_explorers
		owner = { character_event = { id = SSI.74 } }
		4815 = {
		culture = tlaxcalteca
		religion = aztec
		}
		4819 = {
		culture = tlaxcalteca
		religion = aztec
		}
		4820 = {
		culture = tlaxcalteca
		religion = aztec
		}
		4821 = {
		culture = tlaxcalteca
		religion = aztec
		}
		3722 = {
		culture = tlaxcalteca
		religion = aztec
		}
		culture = tlaxcalteca
		religion = aztec
		k_papal_state = {
			holder_scope = {
				create_random_soldier = {
					dynasty = random 
					random_traits = yes
					culture = tlaxcalteca
					religion = aztec
				}
				new_character = {
					c_tlaxcalanew = {
						grant_title = PREV
					}
					set_government_type = republic_government
					c_tlaxcalanew = {
						if = {
							limit = {
								has_dlc = "Zeus"
							}
							add_law = revoke_title_law_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
							}
							add_law = crown_authority_1
						}
					}
					set_defacto_liege = THIS
					
				}
			}
		}
		province_event = { id = SSI.117 }
	}
	
	mean_time_to_happen = {
		months = 50
		modifier = {
			factor = 0.5
			year = 1320
		}
		modifier = {
			factor = 4
			has_game_rule = {
				name = aztec_invasion
				value = random
			}
		}
		modifier = {
			factor = 3
			has_game_rule = {
				name = aztec_invasion
				value = delayed_random
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_001
	}
}
# First Landing of the Aztecs
province_event = {
	id = SSI.117
	desc = EVTDESC_SSI_003
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		culture = tlaxcalteca
		religion = aztec
		c_tlaxcalanew = {
			holder_scope = {
				narrative_event = { id = SSI.118 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_003
	}
}

# First Landing of the Aztecs
narrative_event = {
	id = SSI.118
	title = EVTNAME_SSI_004
	desc = EVTDESC_SSI_004
	major = yes
	hide_new = yes
	
	picture = GFX_evt_battle_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	major_trigger = {
		FROM = { owner = { NOT = { character = PREVPREV } } }
	}
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				capital_scope = {
					NOT = { region = world_india }
				}
			}
			character_event = { id = CM.10020 }  # Chronicle
		}
	
		wealth = 250
		FROM = {
			kingdom = {
				ROOT = {
					war = {
						casus_belli = tribal_invasion
						target = PREVPREV # The top liege of the province owner
						thirdparty_title = PREV # The de jure kingdom
					}
				}
			}
		}
		
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 30
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops = 
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 25
			attributes = {
				martial = 12
			}
			trait = brilliant_strategist
		}
		new_character = {
			spawn_unit = {
				province = FROM
				home = FROM
				troops =
				{
					heavy_infantry = { 2800 2800 }
					light_infantry = { 1400 1300 }
					archers = { 1400 1300 }
				}
			}
		}
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		random = {
			chance = 25
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 30
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 25
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = aztec
				culture = tlaxcalteca
				female = no
				age = 22
				attributes = {
					martial = 12
				}
				trait = brilliant_strategist
			}
			new_character = {
				spawn_unit = {
					province = FROM
					home = FROM
					troops =
					{
						heavy_infantry = { 2800 2800 }
						light_infantry = { 1400 1300 }
						archers = { 1400 1300 }
					}
				}
			}
		}
		
		# Some extra courtiers
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 25
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 26
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 28
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = no
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 17
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 18
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 20
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 16
		}
		create_character = {
			random_traits = yes
			dynasty = random
			religion = aztec
			culture = tlaxcalteca
			female = yes
			age = 16
		}

		any_playable_ruler = {
			limit = { ai = no }
			if = {
				limit = {
					OR = {
						has_power_omen_modifier_trigger = yes
						has_battle_omen_modifier_trigger = yes
					}
				}
				set_character_flag = negative_event_flag # For the scrying outcome calculation...
			}
		}
	}
	
	option = {
		name = EVTOPTA_SSI_004

		trigger = {
			has_power_omen_modifier_trigger = no
			has_battle_omen_modifier_trigger = no
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_004

		if = { # for safety
			limit = {
				OR = {
					has_power_omen_modifier_trigger = yes
					has_battle_omen_modifier_trigger = yes
				}
			}
			set_character_flag = negative_event_flag # For the scrying outcome calculation...
		}

		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes

		tooltip_info = yes
		trigger = {
			OR = {
				has_power_omen_modifier_trigger = yes
				has_battle_omen_modifier_trigger = yes
			}
		}
	}
}